'use strict';

// INTRO AND CHAPTERS

const CHAPTERS = {
    0: 'Goodly reader, in this story you will take the role of Gregory, a curious and youthful gentleman of British birth living in an ambiguous city in 19th century France. And while this story is indeed adventurous — lest its very subtitle be criminally misleading! — you must bear in mind that you, Gregory, are more acquainted with absinthe and vice than firearms and acrobatics.</br>But you will venture forth with empty hands or pockets; we shall not allow you to be so underprepared! At the beginning of this tale you are wearing a fashionable, if cheap, suit — complete with black wool overcoat and starched-felt bowler. You have a pocket watch on a chain. But this is no ordinary pocket watch; this pocket watch has been over-wound and is in need of repair. Your wallet is empty of money; they seem to have taken it all at the bar. In one hand you bear a simple, bronze-headed cane of stained wood, born as an affectation. In your trousers pocket you have a silver ring that you won in a game of chance, a ring that you were hoping to give to your lover. And of course, you would not consider leaving your chamber without an ample supply of intoxicants, which may be found in various flasks and bottles upon your person. It is with these provisions that you begin your absinthe-muddled journey into the depths of the undercity.</br>This book, as you may have conjectured, does not read like a normal book. This book is not constrained by the limits of linear form. You will be allowed to make choices.</br>I won\'t lie to you; some of the choices may very well lead you to your death — or to fates still worse! The honest thing to do, of course, when you reach such an end would be to admit defeat. However, it is important to remember that this is just a book.</br>',
    1: 'The clock tower above your apartment tolls, ringing twice. You sit in your bedroom, which serves as your salon, which serves as your dining room and kitchen, which serves, quite unfortunately, as your water closet. The rain is pooling on the floor by the leaky window, and the wind is rushing through the alley outside with such force that your meager curtains billow and sway.</br>The green-tinted bottle lies empty at your tired feet, but you are not prepared to sleep. There are letters unanswered, and what sort of gentleman would you be if you delayed in your correspondence?</br>After the tolling of the bells, you hear a most curious sound, a sound quite unfamiliar to you. It is the sound of an iron gate perhaps, scraping and squealing from disuse. Or it is the sound of a dozen dogs of hell, scratching their claws of steel on the stone of their prison, howling towards the setting moon. But one thing is certain of the noise: it came from the stairwell right outside your door.</br>',
    2: 'You turn your eyes back to the letter before you, but your mind refuses to follow. Untamed, it thinks only of the gateway to hell that must surely have opened so close at hand, setting unimaginable beasts into the mortal realm. You turn the letter to your lover into a macabre poetry, one that references demons you did not realize you put stock in. The letter to your patron—as the middle-class banker who pays your rent would like to consider himself —is woefully incoherent, and is certain to convince him of your madness.</br>The wind and rain fall silent, and your room has never felt so ominous. The simple lock on the door suddenly seems inadequate, and—as much as you hate to admit it—you begin to question your own courage. You wish another soul were present in the room with you, for even the devils of the ninth hell may seem bearable when you\'ve a friend.</br>',
    3: 'The lamp seems to be out, and the stairwell is dark but for the orange glow that seeps in from the streetlights outside. You pause, letting your eyes adjust to the darkness, and close your door quietly behind you, locking it. </br>At the base of the steps, a floor below you, lies a dark bundle. To your mind it may be a rucksack, or a child. An imp, or a pile of laundry. It does not move.</br>Coming from the belfry upstairs, you hear the unmistakable sound of conflict: heavy breathing and boots clacking on the hardwood. Or perhaps it is the dancing of cloven-hoofed demons?</br>',
    4: 'An hour passes, an hour during which every howl of wind seems to be the wailing of a banshee, an hour that seems interminable. Eventually, after you\'ve calmed yourself with brandy and lie in a drunken near-slumber, the bells above chime thrice. On the third bell, you hear the noise once more. This must be the closing of the door, you rationalize, and soon you pass into dreamless sleep.</br>The next noon you awake, your head set afire by the toxins of vice, your palms bearing clear marks where your nails had dug in. You don your hat and begin to walk to the library. You need a book to read, to be certain, but not this one.</br>',
    5: 'You make your way up the steps, placing your feet near the walls to minimize the creak of the wood, your cane held at your side as a cudgel. Three flights up you walk, past stained-glass windows of undecipherable biblical scenes. The occasional squeak or scratch you make is drowned out by the cacophony of footsteps above.</br>Light filters down the steps from the doorless archway at the top of the stairs. When you reach the belfry, you rub your eyes in disbelief. Certainly, you assure yourself, it is some trick of the wormwood, and the small, green figures before you simply do not exist.</br>But there they are. The belfry is filled with goblins, their long rabbit ears hanging back over their heads, or cocked to strange angles, projecting through their black leather or felt caps. There must be dozens of them filling the small room, each with a unique patchwork outfit; some seem to be workmen and workwomen—perhaps they would be best known simply as workgoblins—in sturdy, functional coveralls, while others are a bizarre parody of your own suited attire, complete with bowler or top hat.</br>Yet while they dangle from rafters with ruler and knife, examine the bells with tuning fork and soundhorn, and scurry about with clipboard and blueprint, they do not appear to be in the process of repairing or maintaining the bell-tower at all. Instead, they appear to constructing some device of their own. It is obvious they have just begun, yet already they have arranged the metal skeleton of some unfathomable machine.</br><img src="images/5.png" alt=""></br>As you gape, you hear a high-pitched voice, speaking clear but accented English. "Pardon, sir, but you might want to wipe your chin."</br>"I\'m sorry?" you ask, and look about confused. You look down and see a clipboard-wielding goblin, who reaches hardly to your knee, offering up a handkerchief.</br>"Your chin. You seem to have leaked. I think if you kept your mouth closed, or perhaps open a bit less wide?"</br>Confused, you take the proffered kerchief and wipe your face</br>',
    6: 'You creep down the steps, one hand on the banister and the other on your cane. When you reach the ground floor, you realize that the stone staircase has a quite unnatural door set into it that you don\'t for the life of you remember, one that gapes darkness and seems sized for but a child.</br>And on closer inspection, you realize that the bundle on the floor is not a bundle at all, but is instead a miniature green man. One with long, floppy ears and tufts of white hair protruding at all angles from his wrinkled scalp. You stare, presuming the prone figure to be asleep or unconscious, until you realize that he stares right back at you, his eyelids open a slit to reveal dark eyes.</br>“Come no closer, gnome,” you say, holding your cane before you as though it alone would hold back demons from the nethers.</br>But as soon as he hears your words, the creature springs forward, lunging towards you and... and crawls between your legs to cower behind you.</br>“Where?” he asks in a frightened voice. “Where are the gnomes? I cannot see them.”</br>Something in his demeanor—perhaps it is his obvious fear that outweighs even your own—puts you at ease and you shake your legs free of him. “I, well... I thought you were a gnome.”</br>/“Of course not! I take offense to such comments.”</br>“And you are...” you question the man whose eyes meet your kneecaps.</br>“A\'gog” he replies, walking slowly up a few steps before turning and facing you at belt-level.</br>“Fascinating,” you reply, because you\'ve never before met such a lucid creature while dreaming. “I\'ve never even heard of a gog. Where do gog\'s come from?”</br>The olive-green fellow jumps up and stamps his feet on the step. “My name is A\'gog. A\'gog the goblin. I am a goblin, and like any goblin from the undercity, the gnomes are my sworn enemies.” A wistful look finds its way into A\'gog\'s eye and he begins to head off on a tangent. “Well, not that the gnomes know we are their sworn enemies. They just think that we work for them. Now, a few couple generations back, in my grandgoblin\'s time...”</br>You stare at him, curious, but he seems to have lost his train of thought.</br>“Well then, A\'gog. My name is Gregory, and I\'m the caretaker of this tower.” This last bit isn\'t the sort of truth you\'d really want to call truth perse. “I admit I\'m rather quite curious what you\'re doing here, where this door came from, and what the racket above our heads is all about.”</br>“And right you would be to be curious! There\'s great work afoot, great work indeed!” A\'gog comes down from his perch and circles you six times clockwise then six times counterclockwise. “I\'ve spelled you good. You are now obliged to take hand in our rescue.”</br>“Am I really?” you ask, because you\'re not certain you believe him.</br>“Yes, of course. It\'s one of those geas curse magic spells that you humans believe in. It\'s where I trick you into thinking that if you don\'t come and do some task, what probably with some kind of shiny reward, you\'ll turn into a goose and be eaten by your fellows. So then, into the underworld! Us goblins need your help!”</br>“And if I don\'t help?”</br>“Well then, my magic curse will turn you into a goose in three days time, that\'s what\'ll happen to you.” </br>“Will it really?” “No.”</br>You sit down on the stones and pull a flask from your hatband. Sipping on spirits usually does you a bit of good in these sorts of situations. Well, you\'ve never been in quite this sort of situation, but it turns out that the gin does, indeed, help. </br>“Spare a swallow of that for an old goblin?” A\'gog asks, and you pass him the flask. </br>“So well, maybe you\'re not cursed or geased or liable to get goosed. But see I\'ll lay it out plain as a planet: we goblins got it bad, real bad. Us and the kabouters—big blind fellows with pasty-white skin and a screech like a bat, you\'d like \'em—we ain\'t been treated like we deserve to be treated. The gnomes have us at lightriflepoint, they do. I\'d rather be dead, I figure. </br>“We\'ve got plans, real good ones and real big ones, to be free. I can\'t say as I know you enough to trust you with the real working going on above our heads though. But we\'re building stuff that\'ll help. Weapons, let\'s say. And I thought I\'d come with, but of course I decided to take a nap down here since I was getting sorta tired, and now they\'ve all gone ahead and started without me and I don\'t really have a role in this no more. I\'m going to go back through that doorway into a dark world of violence, death, and steam-powered contraptions. You can either come with me—be a hero, or at least another fellow with a good-sized stick—or you can go back up into yourlittle room up there and do whatever it is you were doing with your life, and I promise you you\'ll never have another chance to see a world aside from your own.”<</br>The goblin burps, then giggles, yellow sharp teeth protruding from black gums. The laughter sets him off hiccupping, and eventually he falls over on his side in chuckles.</br>'
};

// CHOICES

const CHOICES = {
    0: '<button class="choice" id="choice-0-1" value="1">Click to start</button>',
    1: '<button class="choice" id="choice-1-2" value="2">Refuse to investigate, pass it off as the fancy of your tired mind</button><button class="choice" id="choice-1-3" value="3">Rise, don coat, hat, and cane, and step out of your parlor to see what the trouble is</button>',
    2: '<button class="choice" id="choice-2-4" value="4">Return to your bed and seek the solace of your ratted down comforter, lighting every lamp and praying to the God whose existence you have forsworn</button><button class="choice" id="choice-2-3" value="3">Dress and venture into the hallway, facing what you hope to be imaginary fear</button>',
    3: '<button class="choice" id="choice-3-5" value="5">Venture upstairs into the belfry</button><button class="choice" id="choice-3-6" value="6">Inspect the bundle at the base of the steps</button>',
    4: '<h2>The End</h2>',
    5: '<button class="choice" id="choice-5-9" value="9">Speak courteously to the goblin, and inquire as to their behavior</button><button class="choice" id="choice-5-10" value="10">Represent your landlord\'s interests, demanding that they cease all construction</button>'
};


// FUNCTIONALITY

const storyDiv = document.querySelector('.story-div');
const choicesDiv = document.querySelector('.choices-div');
const startBtn = document.querySelector('.start-button');
const restartBtn = document.querySelector('.restart-button');


function choiceEventListenerAdd() {
    const choiceBtn = document.querySelectorAll('.choice');
    for (let i = 0; i < choiceBtn.length; i++) {
        choiceBtn[i].addEventListener('click', () => {makeChoice(choiceBtn[i].value)});
    }
}


startBtn.addEventListener('click', () => {
    let newStory = document.createElement('p'); // FIX LATER, REPEATING CODE
    newStory.classList.add('chapter-0');
    newStory.innerHTML = CHAPTERS[0];
    storyDiv.appendChild(newStory); // UNTIL HERE

    choicesDiv.innerHTML += CHOICES[0];

    choiceEventListenerAdd()

    startBtn.classList.add('hidden');
    restartBtn.classList.remove('hidden');
});


restartBtn.addEventListener('click', () => {
    storyDiv.innerHTML = '';
    choicesDiv.innerHTML = '';
    startBtn.classList.remove('hidden');
    restartBtn.classList.add('hidden');
})


function makeChoice(input) {
    let newStory = document.createElement('p'); // FIX LATER, REPEATING CODE
    newStory.classList.add(`chapter-${input}`);
    newStory.innerHTML = CHAPTERS[input];
    storyDiv.appendChild(newStory); // UNTIL HERE

    choicesDiv.innerHTML = '';
    choicesDiv.innerHTML += CHOICES[input];

    newStory.scrollIntoView(true);
    
    if (document.querySelector('.choice')) choiceEventListenerAdd()
}